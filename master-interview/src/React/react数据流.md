---
order: 4  
nav:
  title: 面试知识点
  path: /konwledge
---

## 数据流
### state\props\setState

#### state
一个组件最终渲染的数据结果,除了`prop`还有`state`,`state`代表的是当前组件的内部状态,你可以把组件看成一个`状态机`,它是能够随着时间变化的数据,更多的是应当在实现交互时使用,根据状态state的改变呈现不同的UI展示。在React中,因为不能直接修改外部组件传入的prop值。

当需要记录组件自身数据变化时，想要使组件具备交互的能力,那么需要有触发该组件基础数据模型改变的能力,那么此时就需要使用state

一旦组件的状态(数据)发生更改,组件就会自动的调用render函数重新渲染UI,更改这个state状态是通过this.setState方法来触发实现的

**state vs 普通属性**

首先，什么是普通属性？

我们的组件都是使用`ES6`的`class`定义的，所以组件的属性其实也就是`class`的属性（更确切的说法是class实例化对象的属性，但因为JavaScript本质上是没有类的定义的，class只不过是ES6提供的语法糖，所以这里模糊化类和对象的区别）。

在ES6中，可以使用`this.{属性名}`定义一个`class`的属性，也可以说属性是直接挂载到`this`下的变量。因此，`state、props`实际上也是组件的属性，只不过它们是React为我们在`Component class`中预定义好的属性。除了`state、props`以外的其他组件属性称为组件的普通属性。

比如，组件中需要一个定时器来自动更新显示时间时，我们都会需要一个`timerId`来保存该定时器，已在需要的能够清除它。这就是一个普通的属性，因为它和组件要渲染的内容没有直接关系。

因此，当我们在组件中需要用到一个变量，并且它与组件的渲染无关时，就应该把这个变量定义为组件的普通属性，直接挂载到`this`下，而不是作为组件的`state`。或者更直观的判断是，看组件`render`方法中是否使用到了这个变量，如果没有，它就是一个普通属性。

**state vs props**

state和props又有什么区别呢？

state和props都直接和组件的`UI渲染`有关，它们的变化都会触发组件重新渲染，但`props`对于使用它的组件来说是只读的，是通过父组件传递过来的，要想修改`props`，只能在`父组件`中修改；而state是组件内部自己维护的状态，是可变的。

其实区分state和props的关键就是，`控制权`是在组件自身，还是由其父组件来控制的。

**state的判断依据**

- 这个变量是否通过props从父组件中获取？如果是，那么它不是一个状态。
- 这个变量是否在组件的整个生命周期中都保持不变？如果是，那么它不是一个状态。
- 这个变量是否可以通过其他状态（state）或者属性（props）计算得到？如果是，那么它不是一个状态。
- 这个变量是否在组件的render方法中使用？如果不是，那么它不是一个状态。这种情况下，这个变量更适合定义为组件的一个普通属性。

**state的修改**

直接赋值形式修改`state`，不会触发组件的`render`。修改`state`需要通过`setState`方法进行修改。

```js
// 错误
this.state.title = 'React';

// 正确
this.setState({
  title: 'React'
})
```

**state的更新是异步的**

调用`setState`时，组件的state并不会立即改变，`setState`只是把要修改的状态放入一个队列中，React会优化真正的执行时机，并且出于性能原因，可能会将多次`setState`的状态修改合并成一次状态修改。

所以不要依赖当前的state，计算下一个state。当真正执行状态修改时，依赖的`this.state`并不能保证是最新的state，因为React会把多次state的修改合并成一次，这时`this.state`还是这几次state修改前的state。

另外，需要注意的是，同样不能依赖当前的props计算下一个状态，因为props的更新也是异步的。

**state更新是一个合并的过程**

我们在每次调用`setState`修改state时，并不是需要把所有的值都进行修改，而只是设置我们要修改的部分值。React会合并新值导员的组件state中，同时保留没有发生变化的原来的state的值。



#### props
`props` 是 React 用来让组件之间互相联系的一种机制，通俗地说就像方法的参数一样。

props 的传递过程，对于 React 组件来说非常直观。React 的单向数据流，主要的流动管道就是 `props`。props 本身是不可变的。组件的` props` 一定来自于默认属性或通过父组件传递而来。

React 为 props 提供了默认配置，通过 defaultProps 静态变量的方式来定义。

```js
static defaultProps = {
  classPrefix: 'tabs',
  onChange: () => {},
};
```

### 组件间的通信



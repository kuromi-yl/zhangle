---
order: 4
nav:
  title: é¢è¯•çŸ¥è¯†ç‚¹
  path: /konwledge
---

## æ‰‹å†™è®¢é˜…åŠå‘å¸ƒæ¨¡å¼

å‘å¸ƒ-è®¢é˜…æ¨¡å¼å…¶å®æ˜¯ä¸€ç§å¯¹è±¡é—´ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°çŠ¶æ€æ”¹å˜çš„é€šçŸ¥

æ—¢ç„¶ä¸€å¯¹å¤š è‚¯å®šæœ‰ä¸€ä¸ªäº‹ä»¶è°ƒåº¦ä¸­å¿ƒç”¨æ¥è°ƒåº¦äº‹ä»¶ è®¢é˜…è€…å¯ä»¥æ³¨å†Œäº‹ä»¶ï¼ˆ`on`ï¼‰åˆ°äº‹ä»¶ä¸­å¿ƒ å‘å¸ƒè€…å¯ä»¥å‘å¸ƒäº‹ä»¶ï¼ˆ`emit`ï¼‰åˆ°è°ƒåº¦ä¸­å¿ƒ è®¢é˜…è€…ä¹Ÿå¯ä»¥å–æ¶ˆè®¢é˜…ï¼ˆ`off`ï¼‰æˆ–è€…åªè®¢é˜…ä¸€æ¬¡ï¼ˆ`once`ï¼‰

js+classå®ç°

```js
// æ‰‹å†™å‘å¸ƒè®¢é˜…æ¨¡å¼ EventEmitter
class EventEmitter {
  constructor() {
    this.events = {};
  }
  // å®ç°è®¢é˜…
  on(type, callBack) {
    if (!this.events) this.events = Object.create(null);

    if (!this.events[type]) {
      this.events[type] = [callBack];
    } else {
      this.events[type].push(callBack);
    }
  }
  // åˆ é™¤è®¢é˜…
  off(type, callBack) {
    if (!this.events[type]) return;
    this.events[type] = this.events[type].filter(item => {
      return item !== callBack;
    });
  }
  // åªæ‰§è¡Œä¸€æ¬¡è®¢é˜…äº‹ä»¶
  once(type, callBack) {
    function fn() {
      callBack();
      this.off(type, fn);
    }
    this.on(type, fn);
  }
  // è§¦å‘äº‹ä»¶
  emit(type, ...rest) {
    this.events[type] && this.events[type].forEach(fn => fn.apply(this, rest));
  }
}
// ä½¿ç”¨å¦‚ä¸‹
const event = new EventEmitter();

const handle = (...rest) => {
  console.log(rest);
};

event.on("click", handle);

event.emit("click", 1, 2, 3, 4);

event.off("click", handle);

event.emit("click", 1, 2);

event.once("dbClick", () => {
  console.log(123456);
});
event.emit("dbClick");
event.emit("dbClick");

```

```jsx
import React from 'react';
import { Button,message,Space,Switch  } from 'antd';
class EventEmitter {
  constructor() {
    this.events = {};
  }
  // å®ç°è®¢é˜…
  on(type, callBack) {
    if (!this.events) this.events = Object.create(null);

    if (!this.events[type]) {
      this.events[type] = [callBack];
    } else {
      this.events[type].push(callBack);
    }
  }
  // åˆ é™¤è®¢é˜…
  off(type, callBack) {
    if (!this.events[type]) return;
    this.events[type] = this.events[type].filter(item => {
      return item !== callBack;
    });
  }
  // åªæ‰§è¡Œä¸€æ¬¡è®¢é˜…äº‹ä»¶
  once(type, callBack) {
    function fn() {
      callBack();
      this.off(type, fn);
    }
    this.on(type, fn);
  }
  // è§¦å‘äº‹ä»¶
  emit(type, ...rest) {
    this.events[type] && this.events[type].forEach(fn => fn.apply(this, rest));
  }
}
// ä½¿ç”¨å¦‚ä¸‹
const event = new EventEmitter();

const handle = (...rest) => {
  message.success(rest)
  console.log(rest);
};

const hanldeClick=(e)=>{
  console.log(e)
  if(e){
    event.on('click',handle)
  }else{
    event.off('click',handle)
  }
}

const handleClickOnce=()=>{
  event.once('dbClick',()=>{message.success("æ‚¨çš„é¸¡è…¿åˆ°å•¦ğŸ–")});
  message.success("æ‚¨è®¢é˜…äº†ğŸ–,ä½†æ˜¯åªæœ‰ä¸€æ¬¡å“¦")
}

export default () => {
  return (
    <>
      <Space>
        <Switch checkedChildren="è®¢é˜…" unCheckedChildren="å–æ¶ˆ" onClick={hanldeClick} />
        <Button type="primary" onClick={()=>{event.emit('click','å®¢å®˜æ‚¨çš„èœæ¥å•¦ğŸ—ğŸŸğŸ»')}}>å‘å¸ƒ</Button>
      </Space>
      <br />
      <br />
      <Space>
        <Button  onClick={handleClickOnce}>è®¢é˜…ä¸€æ¬¡</Button>
        <Button type="primary" onClick={()=>{event.emit('dbClick')}}>å‘å¸ƒ</Button>
      </Space>
    </>
  )
}


```